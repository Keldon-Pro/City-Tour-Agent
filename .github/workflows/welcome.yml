name: Welcome New Contributors

on:
  issues:
    types: [opened]
  pull_request_target:
    types: [opened]

jobs:
  welcome:
    runs-on: ubuntu-latest
    steps:
      - name: Welcome new contributor
        uses: actions/github-script@v6
        with:
          script: |
            const { owner, repo } = context.repo;
            const contributor = context.payload.sender.login;
            
            // Check if this is the user's first contribution
            const query = `query($owner: String!, $repo: String!, $contributor: String!) {
              repository(owner: $owner, name: $repo) {
                issues(first: 100, filterBy: {createdBy: $contributor}) {
                  totalCount
                }
                pullRequests(first: 100, author: $contributor) {
                  totalCount
                }
              }
            }`;
            
            const result = await github.graphql(query, {
              owner,
              repo,
              contributor
            });
            
            const isFirstContribution = 
              result.repository.issues.totalCount <= 1 && 
              result.repository.pullRequests.totalCount <= 1;
            
            if (isFirstContribution) {
              let message = '';
              
              if (context.eventName === 'issues') {
                message = 'ðŸŽ‰ æ„Ÿè°¢æ‚¨çš„ç¬¬ä¸€ä¸ªIssueï¼\n\n' +
                         'æ¬¢è¿Žæ¥åˆ° City Tour Agent é¡¹ç›®ï¼æˆ‘ä»¬å¾ˆé«˜å…´çœ‹åˆ°æ‚¨çš„å‚ä¸Žã€‚\n\n' +
                         '**æŽ¥ä¸‹æ¥æ‚¨å¯ä»¥ï¼š**\n' +
                         '- ðŸ“– æŸ¥çœ‹æˆ‘ä»¬çš„ [è´¡çŒ®æŒ‡å—](https://github.com/' + owner + '/' + repo + '/blob/main/CONTRIBUTING.md)\n' +
                         '- ðŸ¤ äº†è§£æˆ‘ä»¬çš„ [è¡Œä¸ºå‡†åˆ™](https://github.com/' + owner + '/' + repo + '/blob/main/CODE_OF_CONDUCT.md)\n' +
                         '- ðŸ’¬ åœ¨ [Discussions](https://github.com/' + owner + '/' + repo + '/discussions) ä¸­ä¸Žç¤¾åŒºäº¤æµ\n' +
                         '- ðŸ·ï¸ æŸ¥çœ‹ [good first issue](https://github.com/' + owner + '/' + repo + '/labels/good%20first%20issue) æ ‡ç­¾æ‰¾åˆ°é€‚åˆçš„å…¥é—¨ä»»åŠ¡\n\n' +
                         'æˆ‘ä»¬ä¼šå°½å¿«æŸ¥çœ‹æ‚¨çš„Issueå¹¶æä¾›åé¦ˆã€‚æ„Ÿè°¢æ‚¨å¯¹é¡¹ç›®çš„å…³æ³¨ï¼';
              } else {
                message = 'ðŸŽ‰ æ„Ÿè°¢æ‚¨çš„ç¬¬ä¸€ä¸ªPull Requestï¼\n\n' +
                         'æ¬¢è¿Žæ¥åˆ° City Tour Agent é¡¹ç›®ï¼æˆ‘ä»¬å¾ˆé«˜å…´çœ‹åˆ°æ‚¨çš„è´¡çŒ®ã€‚\n\n' +
                         '**PRå®¡æŸ¥æµç¨‹ï¼š**\n' +
                         '1. æˆ‘ä»¬ä¼šæ£€æŸ¥æ‚¨çš„ä»£ç æ˜¯å¦ç¬¦åˆé¡¹ç›®æ ‡å‡†\n' +
                         '2. è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•\n' +
                         '3. è¿›è¡Œä»£ç å®¡æŸ¥\n' +
                         '4. æä¾›åé¦ˆæˆ–åˆå¹¶\n\n' +
                         '**éœ€è¦å¸®åŠ©ï¼Ÿ**\n' +
                         '- ðŸ“– æŸ¥çœ‹ [è´¡çŒ®æŒ‡å—](https://github.com/' + owner + '/' + repo + '/blob/main/CONTRIBUTING.md)\n' +
                         '- ðŸ’¬ åœ¨PRè¯„è®ºä¸­è¯¢é—®é—®é¢˜\n' +
                         '- ðŸ”„ æ ¹æ®åé¦ˆè¿›è¡Œä¿®æ”¹\n\n' +
                         'æ„Ÿè°¢æ‚¨å¯¹é¡¹ç›®çš„è´¡çŒ®ï¼æˆ‘ä»¬æœŸå¾…ä¸Žæ‚¨çš„åˆä½œã€‚';
              }
              
              await github.rest.issues.createComment({
                owner: owner,
                repo: repo,
                issue_number: context.payload.number,
                body: message
              });
            }