# 嵌入地图组件功能（与实际代码一致）

## 功能概述

在旅游助手应用中集成高德地图组件，为用户提供便捷的地图查看功能。用户可通过右上角的地图浮标按钮快速打开/关闭地图，地图以浮层形式显示在聊天窗口上方，并在左侧栏折叠时自适应扩展，与首页实际代码保持一致。

## 功能特性

- 地图浮标按钮：固定在页面右上角，点击切换显示/隐藏
- 浮层容器：覆盖在聊天窗口上方，具有较高 `z-index`
- 响应式适配：左侧栏折叠时，地图容器宽度自动与右侧聊天窗口同步
- 平滑动画：显示/隐藏过渡动画
- 权限声明：iframe 启用地理定位、剪贴板、全屏与支付权限

## HTML 结构（来自首页实际代码）

```html
<!-- 地图浮标按钮 -->
<div id="map-float-btn" title="打开/关闭地图">
    <i class="fas fa-map-marked-alt"></i>
    </div>

<!-- 高德地图容器 -->
<div id="map-container" class="map-hidden">
    <div class="map-header">
        <span class="map-title">高德地图</span>
        <button id="map-close-btn" class="map-close-btn">
            <i class="fas fa-times"></i>
        </button>
    </div>
    <iframe src="https://ditu.amap.com/" frameborder="0" class="map-iframe"
      allow="geolocation *; clipboard-read *; clipboard-write *; fullscreen *; payment *">
    </iframe>
</div>
```

## CSS 样式要点（与实际首页一致）

```css
/* 地图浮标按钮 */
#map-float-btn {
  position: fixed;
  top: 80px;
  right: 30px;
  width: 50px;
  height: 50px;
  background-color: #4c6ef5;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(76, 110, 245, 0.3);
  transition: all 0.3s ease;
  z-index: 1003;
}

/* 地图容器（初始与右侧一致的尺寸） */
#map-container {
  position: fixed;
  right: 20px;
  top: 70px;
  width: calc(100vw - 480px);
  height: calc(100vh - 90px);
  background-color: #fff;
  border-radius: 10px;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
  z-index: 1001;
  display: flex;
  flex-direction: column;
  transition: all 0.3s ease;
}

/* 隐藏状态 */
#map-container.map-hidden {
  opacity: 0;
  visibility: hidden;
  transform: translateY(-20px);
}
```

> 注：实际代码采用 JavaScript 动态计算来实现对左侧折叠状态的响应，而非纯 CSS 的兄弟选择器规则。

## JavaScript 功能实现（与实际首页一致）

### 初始化与事件绑定

```javascript
function initializeMapFeature() {
  const mapFloatBtn = document.getElementById('map-float-btn');
  const mapContainer = document.getElementById('map-container');
  const mapCloseBtn = document.getElementById('map-close-btn');

  mapFloatBtn.addEventListener('click', toggleMap);
  mapCloseBtn.addEventListener('click', hideMap);
}

// 页面载入完成后初始化地图与布局适配
document.addEventListener('DOMContentLoaded', function() {
  initializeMapFeature();
  syncMapPanelLayout();
});
```

### 显隐控制

```javascript
function toggleMap() {
  const mapContainer = document.getElementById('map-container');
  if (mapContainer.classList.contains('map-hidden')) {
    showMap();
  } else {
    hideMap();
  }
}

function showMap() {
  const mapContainer = document.getElementById('map-container');
  mapContainer.classList.remove('map-hidden');
}

function hideMap() {
  const mapContainer = document.getElementById('map-container');
  mapContainer.classList.add('map-hidden');
}
```

### 左侧折叠自适应（实际实现）

```javascript
function syncMapPanelLayout() {
  const left = document.getElementById('left-column');
  const right = document.getElementById('right-column');
  const map = document.getElementById('map-container');
  if (!left || !right || !map) return;

  const apply = () => {
    const collapsed = left.classList.contains('collapsed');
    document.body.classList.toggle('left-collapsed', collapsed);
    const width = right.clientWidth;
    if (width && width > 0) {
      map.style.width = width + 'px';
    }
  };

  apply();
  const observer = new MutationObserver(apply);
  observer.observe(left, { attributes: true, attributeFilter: ['class'] });
  window.addEventListener('resize', apply);
}
```

## 权限与兼容性

- iframe 启用 `allow="geolocation *; clipboard-read *; clipboard-write *; fullscreen *; payment *"`
- 这些声明与测试页一致，有助于在 iframe 内启用登录与相关权限

## 用户交互流程

- 点击右上角蓝色地图浮标按钮 → 显示地图浮层
- 点击浮层头部关闭按钮或再次点击浮标 → 隐藏地图
- 左侧栏折叠/展开 → 地图浮层宽度随右侧聊天窗口同步

## 设计与性能考量（与实际实现一致）

- 一键切换、平滑动画、视觉层次分明
- 尺寸匹配聊天窗口，保持界面一致性
- 当前实现为 iframe 随页面加载；显示/隐藏通过 CSS 控制
  - 若需按需加载，可在未来优化中改为显示时设置 `src`

## 未来优化方向

1. 增强地图功能：定位、搜索、路线规划
2. 与行程数据联动，支持从对话打开特定地点
3. 懒加载或延迟加载优化，减少初始资源占用
4. 个性化设置：自定义默认位置、缩放级别等
5. 多地图源：支持切换不同地图服务

## 总结

本文档已对齐首页实际代码：使用 iframe 嵌入高德地图并声明所需权限，采用 JavaScript 动态计算实现左侧栏折叠时的自适应布局，显隐由 `map-hidden` 类控制，整体交互与样式与聊天窗口保持一致。