# 分阶段规划

## 核心设计理念

### 产品核心理念

- 🎯 **景点规划是最基础的功能，也是最核心的需求**
- 🏛️ **没有景点规划不能算旅游规划产品**
- 🤝 **Human in the Loop**：始终保持人在决策环节中的主导地位
- 📊 **分阶段规划**：将复杂的旅游规划分解为可管理的阶段
- 🔄 **多次迭代旅游规划**：支持反复优化和调整，而非一次性完成
- 💬 **用户和大模型双向互动**：AI协助人类决策，人类引导AI优化

### 交互设计原则

- **旅游规划需要反复调整、优化，不可能一次完成**
- **人跟AI要双向互动（Interactive）**
- **AI能修改人的方案，人也能修改AI的方案**
- **需要一个AI和人能够直接操作的工具作为沟通桥梁**（我们已经实现行程表，用来跟大模型直接交互）

## 当前状态 vs 目标设计

### 目前状态
大模型直接生成完整的攻略（景点、酒店、美食）

### 目标设计
1. **先协助用户规划完需要参观的景点**
2. **酒店、美食再根据用户需求进行推荐**
3. 
## 参考模式：编程智能体的to-do列表

| Cursor  | 我们的产品设计 |
|---------------------|----------------|
| 面对复杂的问题，生成一个to-do<br>每个任务都是解决问题的步骤 | 给用户的旅游规划分为：<br>1、确定景点<br>2、确定酒店<br>3、确定餐厅 |
| 每完成一个任务后自动进行下一个任务 | 完成一个任务后，停下来询问用户的意见<br>（可以借助行程表） |

## 分阶段规划的流程

### 总体流程图
```
用户输入需求
    ↓
【第一阶段】景点规划
    ↓
用户确认景点方案
    ↓
【第二阶段】酒店推荐（可选）
    ↓
用户确认酒店方案
    ↓
【第三阶段】餐厅推荐
    ↓
完整方案确定
```

### 详细流程说明

#### 阶段0：需求收集（基于现有旅行信息表）
- **直接读取旅行信息表数据**：
  - 基本信息：目的地、旅行日期、出行人数、预算
  - 人群构成：儿童、老人数量（影响景点适宜性）
  - 旅行目的：用户勾选的目的类型
  - 旅游偏好：景点类型、美食偏好、住宿要求等
- **数据预处理和分析**：
  - 解析用户填写的偏好标签
  - 分析旅行目的优先级
  - 确定各阶段的推荐范围和权重
- **无需额外交互**：信息表已包含所有必要数据，直接进入景点规划

#### 阶段1：景点规划（必须完成）
1. **AI生成景点方案**
   - 基于用户需求生成初始景点列表
   - 安排合理的时间和路线
   - 更新行程表

2. **用户交互确认**
   - 用户查看行程表中的景点安排
   - 可以增加、删除、修改景点
   - 可以调整时间安排和顺序

3. **方案优化迭代**
   - AI根据用户修改重新优化路线
   - 多轮对话直到用户满意
   - 确认进入下一阶段

#### 阶段2：酒店推荐（看用户需求）
1. **基于行程推荐酒店**
   - 根据每日行程推荐合适位置的酒店
   - 考虑预算和住宿偏好
   - 优化整体出行便利性

2. **用户交互确认**
   - 用户查看酒店推荐
   - 可以替换不满意的酒店
   - 可以调整住宿安排

3. **方案优化**
   - 确保酒店位置与行程的便利性
   - 优化整体住宿安排

#### 阶段3：餐厅推荐（看用户需求）
1. **基于景点推荐餐厅**
   - 根据景点位置推荐附近餐厅
   - 考虑时间安排（早餐、午餐、晚餐）
   - 结合用户饮食偏好和预算

2. **用户最终确认**
   - 查看完整的旅游方案
   - 做最后的调整
   - 确认完整方案

### 流程控制要点
- **强制停顿**：每个阶段完成后必须等待用户反馈
- **可回退**：用户可以返回前一阶段重新规划
- **状态保存**：每个阶段的结果都被保存，支持恢复
- **增量优化**：后续阶段基于前面确定的结果进行推荐



## 交互流程设计

### 核心交互模式
```
0. 需求收集 → 读取旅行信息表 → 数据预处理 → 直接进入景点规划
1. 用户需求 → AI生成景点方案 → 用户确认/修改 → 景点方案确定
2. 基于景点 → AI推荐酒店 → 用户确认/修改 → 酒店方案确定（看用户需求）  
3. 基于行程 → AI推荐餐厅 → 用户确认/修改 → 完整方案确定（看用户需求）
```

### 每个阶段的停顿点
- **阶段0完成后**：无需停顿，信息表已包含所有数据，直接进入景点规划
- **完成景点规划后**：强制停顿，询问用户意见，确认是否满意并进入下一阶段
- **完成酒店推荐后**：停下来询问用户意见，确认是否需要调整（看用户需求决定是否执行）
- **完成餐厅推荐后**：最终确认整体方案（看用户需求决定是否执行）

### 阶段执行策略
- **阶段1（景点规划）**：必须完成，核心功能
- **阶段2（酒店推荐）**：看用户需求，可选执行
- **阶段3（餐厅推荐）**：看用户需求，可选执行

### 用户反馈机制
- **多轮对话优化**：每个阶段都支持用户反复修改直到满意
- **强制用户确认**：每个阶段完成后必须等待用户确认才能继续
- **灵活阶段选择**：用户可以选择跳过酒店或餐厅推荐阶段

### 工具支持
- **旅行信息表**：旅游规划的起点，作为系统的**长期记忆**，存储用户偏好和约束数据
- **行程表**：旅游规划的终点，作为大模型的**短期记忆**，承载当前规划结果并支持AI和人直接操作的沟通桥梁
- **实时更新**：基于短期记忆（行程表）的每次修改都立即体现
- **版本管理**：基于长期记忆和短期记忆的状态快照，支持回退到之前的方案版本
- **状态保存**：长期记忆（用户偏好）和短期记忆（当前行程）的持久化存储
- **增量优化**：利用长期记忆指导短期记忆的优化，后续阶段基于前面确定的结果进行推荐


## 分阶段实施方案

### 第一阶段：景点规划（核心功能）
**目标**：实现最基础、最核心的景点规划功能

**功能要求**：
- 根据用户输入（目的地、时间、偏好）生成景点推荐
- 支持用户对景点进行增删改
- 生成基本的时间安排和路线规划
- 通过行程表与用户进行交互

**成功标准**：
- 用户能够获得满意的景点安排
- 支持多轮对话优化
- 行程表能够实时更新

### 第二阶段：餐厅推荐（重要补充）
**目标**：基于已确定的景点，推荐合适的餐厅

**功能要求**：
- 基于景点位置推荐附近餐厅
- 考虑用户饮食偏好和预算
- 与景点安排时间匹配（早餐、午餐、晚餐）
- 支持用户调整和替换

**设计考虑**：
- 选饭店比选酒店难很多，需要更细致的推荐逻辑
- 与景点的地理位置和时间安排紧密结合

### 第三阶段：酒店推荐（可选功能）
**目标**：为多日行程提供住宿建议

**功能要求**：
- 基于行程安排推荐合适位置的酒店
- 考虑预算和住宿偏好
- 与整体行程时间匹配

**设计考虑**：
- 相对简单，主要考虑位置和预算
- 可以作为可选功能实现