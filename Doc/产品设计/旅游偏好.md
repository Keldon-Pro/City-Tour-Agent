# 旅游偏好分析（Haikou Tour）

## 核心偏好维度

* **住宿类型**：经济型 / 舒适型 / 高档型 / 民宿 / 特色酒店
	- 舒适型：环境较好，服务完善，性价比高，适合大众需求。
	- 高档型：高端酒店，设施豪华，服务优质，适合追求品质的游客。
	- 民宿：本地居民经营，体验当地生活，氛围温馨。
	- 特色酒店：具有独特设计或文化元素，提供差异化体验。

* **餐饮偏好**：是否尝试当地特色美食 / 偏好常规餐饮 / 对美食重视程度
	- 是否尝试当地特色美食：愿意品尝本地特色菜肴，体验地方饮食文化。
	- 偏好常规餐饮：更倾向于熟悉的餐饮类型，如中餐、快餐等。
	- 对美食重视程度：对餐饮体验的关注度，从随意到极度重视美食。

* **出行方式**：打车 / 公交 / 自驾 / 步行 / 租车
	- 打车：灵活便捷，适合小团体或对舒适度有要求的游客。
	- 公交：经济实惠，适合预算有限或体验本地生活的游客。
	- 自驾：自由度高，适合探索周边或多地游玩。
	- 租车：适合无自驾车辆但有自驾需求的游客。


---

## 系统实现功能

### 技术架构概览

```
用户界面层 (index.html)
├── 偏好展示组件
├── 图标动态加载
└── 交互式选择器

管理界面层 (doc.html)  
├── 类别管理模块
├── 图标选择器
└── 偏好项编辑器

数据持久层 (localStorage)
├── categoryIcons (图标配置)
├── travelPreferences (用户偏好)
└── flatPreferences (偏好结构)
```

#### 技术栈
- **前端**：原生HTML5 + CSS3 + JavaScript ES6
- **图标库**：FontAwesome 6.x (CDN)
- **数据存储**：Web API localStorage
- **界面框架**：响应式CSS，移动端适配

### 1. 用户界面功能（index.html）

#### 偏好展示与选择
- **动态图标显示**：每个偏好类别支持自定义图标，默认为星形图标（fas fa-star）
- **扁平化布局**：垂直排列的偏好类别，每个类别下为选项列表
- **复选框选择**：支持多选的预设选项
- **自定义输入**：用户输入项支持动态显示/隐藏输入框
- **数据持久化**：localStorage存储图标选择和用户偏好设置

### 2. 管理界面功能（doc.html）

#### 类别管理
- **动态添加类别**：支持创建新的偏好类别
- **类别删除**：可删除现有偏好类别（含确认提示）
- **标签页切换**：多类别的标签页管理界面

#### 图标管理系统
- **图标库**：提供30个常用FontAwesome图标
- **图标选择器**：弹窗式图标选择界面，网格布局
- **实时预览**：选择图标后立即更新类别标签显示

#### 偏好项管理
- **预设选项管理**：添加、编辑、删除预设选项
- **自定义输入项管理**：支持编辑显示名称和占位符文本
- **即时编辑**：新选项自动进入编辑模式，支持键盘操作（Enter保存，Esc取消）

### 3. 数据结构

#### 扁平化数据格式
```javascript
{
  "住宿类型": [
    "经济型酒店",
    "商务酒店", 
    {
      "type": "input",
      "name": "指定酒店品牌",
      "placeholder": "例如：全季、如家、汉庭"
    }
  ],
  "餐饮选择": [
    "当地特色菜",
    "海鲜大排档",
    {
      "type": "input",
      "name": "饮食禁忌",
      "placeholder": "例如：不吃辣、素食"
    }
  ]
}
```

#### 混合选项类型
- **字符串类型**：预设选项，直接显示为复选框
- **对象类型**：自定义输入项，包含type、name、placeholder字段

#### 数据格式要求
- **严格格式验证**：系统仅支持扁平化混合格式，不再兼容旧版本数据结构
- **必需字段检查**：自定义输入项必须包含`type: "input"`、`name`和`placeholder`字段
- **类型限制**：偏好项只允许字符串或符合规范的输入对象两种类型

### 4. 核心技术实现

#### 前端渲染机制
- **扁平化渲染函数**（`createPreferenceGroupFlat`）：将扁平化数据结构渲染为可交互的HTML元素
- **动态图标加载**：从localStorage读取图标设置，使用FontAwesome动态渲染
- **状态管理**：实时同步DOM状态与localStorage数据，保证页面刷新后状态恢复

#### 数据持久化
```javascript
// 图标设置存储格式
localStorage.setItem('categoryIcons', JSON.stringify({
  "住宿类型": "fas fa-bed",
  "餐饮选择": "fas fa-utensils"
}));

// 用户偏好存储格式  
localStorage.setItem('travelPreferences', JSON.stringify({
  "住宿类型": ["经济型酒店", "商务酒店"],
  "餐饮选择": ["当地特色菜"]
}));
```

#### 管理界面核心功能
- **标签页管理**：动态创建和删除类别标签页，支持空状态处理
- **图标选择器**：弹窗式30图标库，网格布局，点击选择机制
- **即时编辑模式**：新增选项自动进入编辑状态，支持Enter保存、Esc取消
- **数据同步**：管理界面的修改通过localStorage实时同步到用户界面

#### 错误处理与边界情况
- **空数据处理**：首次访问或数据清空时的默认状态
- **数据格式验证**：严格校验localStorage中的数据格式，拒绝不符合规范的数据
- **类型检查**：对偏好项进行严格的类型检查，确保数据结构的一致性

---

## 使用指南

### 管理员操作流程

1. **类别管理**：点击"新增类别"添加偏好类别，使用删除按钮移除类别
2. **图标管理**：选择偏好类别后，点击"更换图标"按钮选择合适的图标
3. **选项管理**：点击"添加选项"或"添加用户输入项"创建新选项，自动进入编辑模式

### 用户使用体验

1. **偏好选择**：浏览不同的偏好类别，勾选感兴趣的选项
2. **自定义输入**：对于自定义输入项，勾选后在输入框中填写具体内容
3. **数据保存**：用户选择自动保存到本地，页面刷新后状态自动恢复

---

## 技术部署与维护

### 部署要求
- **Web服务器**：支持静态文件服务（Apache/Nginx/IIS）
- **浏览器兼容性**：Chrome 60+, Firefox 55+, Safari 12+, Edge 79+
- **网络依赖**：FontAwesome CDN（可选离线部署）

### 文件结构
```
/WebPage-Flask/
├── templates/
│   ├── index.html          # 用户界面
│   └── doc.html           # 管理界面
├── static/
│   ├── css/               # 样式文件
│   └── js/                # JavaScript逻辑
└── data/
    └── flatPreferences.json  # 默认偏好数据
```

### 配置管理
- **默认偏好配置**：修改 `data/flatPreferences.json` 文件
- **图标库扩展**：在 `doc.html` 中的 `iconOptions` 数组添加新图标
- **样式定制**：CSS变量控制主题色彩和布局参数

### 数据备份与恢复
- **备份**：导出localStorage数据为JSON格式
- **恢复**：管理界面支持JSON数据导入
- **重置**：清空localStorage恢复默认设置

### 性能优化
- **懒加载**：图标按需加载，减少初始页面大小
- **缓存策略**：静态资源文件缓存，localStorage本地缓存
- **响应式设计**：移动端和桌面端自适应布局





